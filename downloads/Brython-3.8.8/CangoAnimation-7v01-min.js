var Timeline,Tweener,Track,TrackTweener;Cango=function(t){"use strict";Tweener=class{constructor(t,i,s){this.delay=t||0,this.dur=i||5e3,this.reStartOfs=0,this.loop=!1,this.loopAll=!1;let e="noloop";"string"==typeof s&&(e=s.toLowerCase()),"loop"===e?this.loop=!0:"loopall"===e&&(this.loopAll=!0)}getVal(t,i,s){let e,n,o,r;0===t&&(this.reStartOfs=0),(r=t-this.reStartOfs)>this.dur+this.delay&&this.dur>0&&(this.loop||this.loopAll)&&(this.reStartOfs=this.loop?t-this.delay:t,r=0);let a=0;if(r>this.delay&&(a=r-this.delay),!Array.isArray(i))return i;if(!i.length)return 0;if(1===i.length)return i[0];if(0===a)return i[0];if(a>=this.dur)return i[i.length-1];const h=i.length-1;if(!Array.isArray(s)||i.length!==s.length)return e=this.dur/h,o=(a-(n=Math.floor(a/e))*e)/e,i[n]+o*(i[n+1]-i[n]);const l=[].concat(i),c=[].concat(s);0!==c[0]&&(l.unshift(l[0]),c.unshift(0)),100!==c[c.length-1]&&(l.push(l[l.length-1]),c.push(100));let m=a/this.dur,u=0;for(;u<c.length-1&&c[u+1]/100<m;)u++;return e=(c[u+1]-c[u])/100,o=(m-c[u]/100)/e,l[u]+o*(l[u+1]-l[u])}};class i{constructor(t){const i=t;this.segPoints=[{x:i[0],y:i[1]},{x:i[2],y:i[3]},{x:i[4],y:i[5]},{x:i[6],y:i[7]}],this.segLength=this._length(this.segPoints)}_pointOnCubicBez(t,i){return{x:(i=>t[0].x*(1-i)*(1-i)*(1-i)+3*t[1].x*i*(1-i)*(1-i)+3*t[2].x*i*i*(1-i)+t[3].x*i*i*i)(i),y:(i=>t[0].y*(1-i)*(1-i)*(1-i)+3*t[1].y*i*(1-i)*(1-i)+3*t[2].y*i*i*(1-i)+t[3].y*i*i*i)(i)}}_dist(t,i){return Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y))}_length(t){for(var i=this._pointOnCubicBez(t,0),s=0,e=0,n=null;e<1;)e+=.005,n=this._pointOnCubicBez(t,e),s+=this._dist(n,i),i=n;return s}_gradientAtPoint(t,i,s){let e,n;i>.994?(e=this._pointOnCubicBez(t,i-.005),n=this._pointOnCubicBez(t,i)):(e=this._pointOnCubicBez(t,i),n=this._pointOnCubicBez(t,i+.005));const o=n.y-e.y,r=n.x-e.x;return Math.atan2(o,s*r)}pointAlongPath(t,i,s){const e=.005*(s>0?1:-1);let n=this._pointOnCubicBez(t,i),o=0,r=i,a=this._pointOnCubicBez(t,i);for(;o<Math.abs(s);)r+=e,a=this._pointOnCubicBez(t,r),o+=this._dist(a,n),n=a;return{point:a,location:r,distance:s}}}class s{constructor(t){const i=t;this.segPoints=[{x:i[0],y:i[1]},{x:i[2],y:i[3]}],this.segLength=Math.sqrt((i[2]-i[0])*(i[2]-i[0])+(i[3]-i[1])*(i[3]-i[1]))}_gradientAtPoint(t,i,s){const e=this.segPoints,n=e[1].y-e[0].y,o=e[1].x-e[0].x;return Math.atan2(n,s*o)}pointAlongPath(t,i,s){const e=this.segPoints,n=(s-i)/this.segLength;return{point:{x:e[0].x+n*(e[1].x-e[0].x),y:e[0].y+n*(e[1].y-e[0].y)},location:n,distance:s}}}Track=class{constructor(t){if(!(t instanceof SVGsegs))return void console.warn("TypeError: Track argument 0 not SVGsegs");const e=t;if(this.segs=[],"M"!==e[0].type)return void console.warn("Track segments must start with 'M' command");const n=e[0].values;let o=e[0].values.slice(0);for(let t=1;t<e.length;t++){let r,a=e[t];if("C"===a.type)r=o.concat(a.values),this.segs.push(new i(r)),o=[a.values[4],a.values[5]];else if("L"===a.type)r=o.concat(a.values),this.segs.push(new s(r)),o=a.values;else if("Z"===a.type){if(o[0]==n[0]&&o[1]==n[1])break;r=o.concat(n),this.segs.push(new s(r));break}}this.totalLength=this.segs.reduce((t,i)=>t+i.segLength,0)}},TrackTweener=class{constructor(t,i,s,e){if(!t instanceof Track)return void console.warn("TrackTweener first argument not Track object");this.track=t,this.delay=i||0,this.dur=s||5e3,this.reStartOfs=0,this.loop=!1,this.loopAll=!1,this.prevDist=0;let n="noloop";"string"==typeof e&&(n=e.toLowerCase()),"loop"===n?this.loop=!0:"loopall"===n&&(this.loopAll=!0),this.segEndDist=[];let o=0;this.track.segs.forEach(t=>{o+=t.segLength,this.segEndDist.push(o)})}_getDist(t,i=[],s){0===t&&(this.reStartOfs=0);let e=t-this.reStartOfs;e>this.dur+this.delay&&this.dur>0&&(this.loop||this.loopAll)&&(this.reStartOfs=this.loop?t-this.delay:t,e=0);let n=0;if(e>this.delay&&(n=e-this.delay),"number"==typeof i)return 0<=i&&i<=100?i:(console.warn("TrackTweener.getPos outside the 0..100 range"),0);if(!i.length)return 0;if(1===i.length)return i[0];for(let t=0;t<i.length;t++)if(0<=i&&i<=100)return console.warn("TrackTweener.getPos outside the 0..100 range"),0;if(0===n)return i[0];if(n>=this.dur)return i[i.length-1];const o=i.length-1;if(!Array.isArray(s)||i.length!==s.length){let t=this.dur/o,s=Math.floor(n/t),e=(n-s*t)/t;return i[s]+e*(i[s+1]-i[s])}const r=[].concat(i),a=[].concat(s);0!==a[0]&&(r.unshift(r[0]),a.unshift(0)),100!==a[a.length-1]&&(r.push(r[r.length-1]),a.push(100));let h=n/this.dur,l=0;for(;l<a.length-1&&a[l+1]/100<h;)l++;let c=(a[l+1]-a[l])/100,m=(h-a[l]/100)/c;return r[l]+m*(r[l+1]-r[l])}_distToPos(t){const i=this.track.totalLength;let s,e=0,n=0;for(let o=0;o<this.segEndDist.length&&!((n+=(s=this.track.segs[o]).segLength)>=t);o++)(e=n)>=i&&(this.loop||this.loopAll)&&(n=(s=this.track.segs[0]).segLength,e=0,t-=i);const o=t-e,r=s.pointAlongPath(s.segPoints,0,o),a=r.point.x>=this.prevX?-1:1,h=s._gradientAtPoint(s.segPoints,r.location,a),l=t<this.prevDist?h-Math.PI:h;return{x:r.point.x,y:r.point.y,gradient:l}}getPos(t,i,s){const e=this.track.totalLength*this._getDist(t,i,s)/100;return this._distToPos(e)}getPosArray(t,i,s,e){const n=this.track.totalLength,o=i.length+1,r=[];let a=0;a=i.reduce((t,i)=>t+=i,0);const h=this.loop||this.loopAll?1:(n-a)/n,l=this.loop||this.loopAll?s:s.map(t=>h*t);let c=n*this._getDist(t,l,e)/100;r[0]=this._distToPos(c);for(let t=1;t<o;t++)c+=i[t-1],r[t]=this._distToPos(c);return r}};function e(t){const i=Date.now();let s,e,n=null,o=!1;t.prevAnimMode===t.modes.STOPPED&&(t.startTime=i-t.startOfs),s=i-t.startTime,t.animTasks.forEach(i=>{i.gc.cId!==n&&(o=!0,n=i.gc.cId),i.gc.ctx.save(),t.prevAnimMode===t.modes.STOPPED&&(i.currState.time=0),o&&!i.options.manualClear&&i.gc.clearCanvas(),"function"==typeof i.pathFn&&i.pathFn.call(i,s,i.options),"function"==typeof i.drawFn&&i.drawFn.call(i,i.options),o=!1,i.gc.ctx.restore(),e=i.currState,i.currState=i.nextState,i.nextState=e,i.currState.time=s}),t.currTime=s}return Timeline=class{constructor(){this.animTasks=[],this.timer=null,this.modes={PAUSED:1,STOPPED:2,PLAYING:3,STEPPING:4},this.animMode=this.modes.STOPPED,this.prevAnimMode=this.modes.STOPPED,this.startTime=0,this.startOfs=0,this.currTime=0,this.stepTime=50,this.frameRate=void 0,this.interval=0}stopAnimation(){clearTimeout(this.timer),window.cancelAnimationFrame(this.timer),this.prevAnimMode=this.animMode,this.animMode=this.modes.STOPPED,this.currTime=0,this.startOfs=0}pauseAnimation(){clearTimeout(this.timer),window.cancelAnimationFrame(this.timer),this.prevAnimMode=this.animMode,this.animMode=this.modes.PAUSED}stepAnimation(){this.animMode!==this.modes.PLAYING&&(this.animMode===this.modes.PAUSED&&(this.startTime=Date.now()-this.currTime),this.prevAnimMode=this.animMode,this.animMode=this.modes.STEPPING,setTimeout(()=>{e(this),this.prevAnimMode=this.modes.PAUSED,this.animMode=this.modes.PAUSED},this.stepTime))}redrawAnimation(){this.animMode!==this.modes.PLAYING&&(this.startTime=Date.now()-this.currTime,e(this))}playAnimation(t,i){let s=0;const n=()=>{e(this),this.prevAnimMode=this.modes.PLAYING,i&&this.currTime>=i?this.stopAnimation():this.frameRate?(this.interval=1e3/this.frameRate,this.currTime+=this.interval,s=Date.now()-this.startTime-this.currTime,this.timer=setTimeout(n,this.interval-s)):this.timer=window.requestAnimationFrame(n)};this.startOfs=t||0,this.animMode!==this.modes.PLAYING&&(this.animMode===this.modes.PAUSED&&(this.startTime=Date.now()-this.currTime),this.prevAnimMode=this.animMode,this.animMode=this.modes.PLAYING,this.timer=window.requestAnimationFrame(n))}},t.prototype.animation=function(t,i,s,e){const n=new class{constructor(t,i,s,e,n,o){this.id=t,this.gc=i,this.drawFn=e,this.pathFn=n,this.options=o||{},this.currState={time:0},this.nextState={time:0},this.gc.ctx.save(),"function"==typeof s&&s.call(this,this.options),"function"==typeof this.drawFn?this.drawFn.call(this,this.options):console.log("invalid animation draw function"),this.gc.ctx.restore();for(let t in this.nextState)this.nextState.hasOwnProperty(t)&&(this.currState[t]=this.nextState[t])}}(this.cId+"_"+this.getUnique(),this,t,i,s,e);return this.stopAnimation(),this.bkgCanvas.timeline.animTasks.push(n),n.id},t.prototype.pauseAnimation=function(){this.bkgCanvas.timeline.pauseAnimation()},t.prototype.playAnimation=function(t,i){this.bkgCanvas.timeline.playAnimation(t,i)},t.prototype.stopAnimation=function(){this.bkgCanvas.timeline.stopAnimation()},t.prototype.stepAnimation=function(){this.bkgCanvas.timeline.stepAnimation()},t.prototype.redrawAnimation=function(){this.bkgCanvas.timeline.redrawAnimation()},t.prototype.deleteAnimation=function(t){this.pauseAnimation(),this.bkgCanvas.timeline.animTasks.forEach((i,s)=>{i.id!==t||this.bkgCanvas.timeline.animTasks.splice(s,1)})},t.prototype.deleteAllAnimations=function(){this.stopAnimation(),this.bkgCanvas.timeline.animTasks=[]},t}(Cango);